include ../partials/mixins

doctype html
html.no-js
  head
    meta(charset="utf-8")
    meta(http-equiv="X-UA-Compatible", content="IE=edge")
    
    - var home = config.service.authority;
    - var title = (page && page.title) ? page.title : config.service.name;
    - var image = (page && page.image) ? page.image : 'https://' + home + '/img/maki.png';
    - var masthead = (page && page.masthead) ? page.masthead : null;
    - var description = (page) ? page.description || page.title || config.service.name + ': ' + config.service.mission : config.service.name + ': ' + config.service.mission;

    title #{title}

    meta(name="description", content="#{description}")
    meta(name="viewport", content="width=device-width, initial-scale=1")

    block meta
      meta(name="og:title", content="#{title}")
      meta(name="og:type", content="website")
      meta(name="og:image", content="#{image}")
      meta(name="og:url", content="#{home}")
      meta(name="og:description", content="#{description}")
      
      meta(name="twitter:card", content="summary")
      meta(name="twitter:site", content="@MadeWithMaki")
      meta(name="twitter:title", content="#{title}")
      meta(name="twitter:description", content="#{description}")
      meta(name="twitter:image", content="#{image}")

    link(rel="stylesheet", href="/css/semantic.min.css")
    link(rel="stylesheet", href="/css/highlight/maki.css")
    link(rel="stylesheet", href="/css/maki.css")
    link(rel="stylesheet", href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Open+Sans:300italic,400,300,700|Playball")

    link(rel="import", href="/polymer/polymer.html")
    link(rel="import", href="/components")

    script(src="/js/jquery.js")
    script(src="/js/bundle.js")

    base(href="/")

  body
    maki-application
      include ../partials/scaffold

    block scripts

    script.
      window.addEventListener('load', function() {
        // fix menu when passed
        $('.masthead').visibility({
          once: false,
          onBottomPassed: function() {
            $('.fixed.menu').transition('fade in');
          },
          onBottomPassedReverse: function() {
            $('.fixed.menu').transition('fade out');
          }
        });

        // create sidebar and attach to menu open
        $('.ui.sidebar').sidebar('attach events', '.toc.item');

        $(document).on('click', '*[on-tap=toggle-reply-form]', function(e) {
          e.preventDefault();
          
          var $el = $(this);
          var target = $el.data('target-id');

          $('[data-for=message-reply-form]:not([data-target-id=' + target + '])').slideUp();

          $('[data-for=message-reply-form][data-target-id=' + target + ']').slideToggle();
          $('[data-for=message-reply-form][data-target-id=' + target + '] textarea[name=content]').focus();

          return false;
        });
      });

      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-57746323-1', 'auto');
      ga('send', 'pageview');
